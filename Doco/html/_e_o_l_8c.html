<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Alarm Cabinent: PIC Code/EOL.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Alarm Cabinent</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">PIC Code/EOL.c File Reference</div>  </div>
</div>
<div class="contents">

<p>End Of Line detection, hardware interface.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;TCPIP Stack/TCPIP.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="_security_system_8h_source.html">SecuritySystem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="x_p_l_8h_source.html">xPL.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for EOL.c:</div>
<div class="dyncontent">
<div class="center"><iframe src="_e_o_l_8c__incl.svg" width="659" height="150" frameborder="0" scrolling="no"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="_e_o_l_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4">Zone_States</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_o_l_8c.html#a1cabc40dfab4455722bcd809c23ed21d">CheckEOL</a> (int ZoneID, WORD *ADval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4">Zone_States</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_o_l_8c.html#a44f4ef2b28f2d65b626e1ec4e5885934">IsZoneTriggered</a> (int ZoneID)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_e_o_l_8c.html#a158856c40ce33f6a7ac1f7b0808aa8e1">HTTPPrint_EOLValue</a> (WORD num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the analogue value read from the zone, calls <a class="el" href="_e_o_l_8c.html#a1cabc40dfab4455722bcd809c23ed21d">CheckEOL()</a> to determine the value.  <a href="#a158856c40ce33f6a7ac1f7b0808aa8e1"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>End Of Line detection, hardware interface. </p>

<p>Definition in file <a class="el" href="_e_o_l_8c_source.html">EOL.c</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1cabc40dfab4455722bcd809c23ed21d"></a><!-- doxytag: member="EOL.c::CheckEOL" ref="a1cabc40dfab4455722bcd809c23ed21d" args="(int ZoneID, WORD *ADval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4">Zone_States</a> CheckEOL </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ZoneID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD *&#160;</td>
          <td class="paramname"><em>ADval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine if the EOL has been triggered. If so sends triggeres alarm once disarmed it will not set the alarm off again until armed again. This is the hardwaare component to checking the zone status, mostly called by <a class="el" href="_e_o_l_8c.html#a44f4ef2b28f2d65b626e1ec4e5885934">IsZoneTriggered()</a> </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>ensure arm fails when EOL is triggered</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ZoneID,the</td><td>zone number to be checked </td></tr>
    <tr><td class="paramname">WORD*</td><td>ADval, outputs the analogue reading of the sensor, used for HTTPPrint </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Zone_States, the outcome of the checked zone sensor </dd></dl>

<p>Definition at line <a class="el" href="_e_o_l_8c_source.html#l00023">23</a> of file <a class="el" href="_e_o_l_8c_source.html">EOL.c</a>.</p>

<p>References <a class="el" href="_main_demo_8c_source.html#l00031">AN0String</a>, <a class="el" href="_security_system_8h_source.html#l00019">EOLNORMAL</a>, <a class="el" href="_security_system_8h_source.html#l00021">EOLTOLERANCE</a>, <a class="el" href="_security_system_8h_source.html#l00020">EOLTRIGGER</a>, <a class="el" href="x_p_l_8h_source.html#l00004">FALSE</a>, <a class="el" href="_hardware_profile_8h_source.html#l00086">PLEXERA_0_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00084">PLEXERA_1_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00082">PLEXERA_2_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00080">PLEXERA_S_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00096">PLEXERB_0_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00094">PLEXERB_1_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00092">PLEXERB_2_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00090">PLEXERB_S_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00106">PLEXERC_0_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00104">PLEXERC_1_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00102">PLEXERC_2_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00100">PLEXERC_S_IO</a>, <a class="el" href="_hardware_profile_8h_source.html#l00204">putrsUART</a>, <a class="el" href="_security_system_8h_source.html#l00155">StateNormal</a>, <a class="el" href="_security_system_8h_source.html#l00157">StateTamper</a>, <a class="el" href="_security_system_8h_source.html#l00156">StateTrigger</a>, <a class="el" href="x_p_l_8h_source.html#l00005">TRUE</a>, and <a class="el" href="_security_system_8c_source.html#l00143">ZoneConfig</a>.</p>

<p>Referenced by <a class="el" href="_e_o_l_8c_source.html#l00346">HTTPPrint_EOLValue()</a>, and <a class="el" href="_e_o_l_8c_source.html#l00154">IsZoneTriggered()</a>.</p>
<div class="fragment"><pre class="fragment">                                               {
        
        <span class="keywordtype">char</span> <a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>[7];
        <span class="keywordtype">char</span> DebugTemp[7];
        <span class="keywordtype">int</span> PlexerDevice, BinaryValue;
        
        <span class="comment">// Disable all analogue multiplexer</span>
        <a class="code" href="_hardware_profile_8h.html#a8514179f2544ebf359aaac6240696bdc">PLEXERA_S_IO</a> = 1; <span class="comment">// High = disabled            </span>
        <a class="code" href="_hardware_profile_8h.html#a4d7abba9aa379431b6afdb1be055001e">PLEXERB_S_IO</a> = 1;
        <a class="code" href="_hardware_profile_8h.html#a6ea00703a12039dc8ef55ef3a04f2bb1">PLEXERC_S_IO</a> = 1;
        
        <span class="comment">// Select the analogue multiplexer</span>
        PlexerDevice = ZoneID / 8;
        BinaryValue = ZoneID - ((ZoneID / 8) * 8); <span class="comment">// The value can now be expressed as a 3 bit value</span>
        
        
        <span class="keywordflow">if</span> (PlexerDevice == 0) {
                
                <a class="code" href="_hardware_profile_8h.html#a8514179f2544ebf359aaac6240696bdc">PLEXERA_S_IO</a> = 0; <span class="comment">//enable this device</span>
                <a class="code" href="_hardware_profile_8h.html#aa547ab8a4ada6918d048ff9723123699">PLEXERA_2_IO</a> = ((BinaryValue / 4 &gt; 0)?<a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>:<a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
                BinaryValue -= (BinaryValue / 4) * 4;           
                <a class="code" href="_hardware_profile_8h.html#ae9fc28adb8ff12e4031c2d60ff4a3fed">PLEXERA_1_IO</a> = ((BinaryValue / 2 &gt; 0)?<a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>:FALSE);
                BinaryValue -= (BinaryValue / 2) * 2;           
                <a class="code" href="_hardware_profile_8h.html#ad240303934714b68c211983564279b6e">PLEXERA_0_IO</a> = ((BinaryValue &gt; 0)?<a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>:FALSE);
                
        } <span class="comment">// PlexerDevice ==0</span>
        
        
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PlexerDevice == 1) {
                <a class="code" href="_hardware_profile_8h.html#a4d7abba9aa379431b6afdb1be055001e">PLEXERB_S_IO</a> = 0; <span class="comment">//enable this device</span>
                <a class="code" href="_hardware_profile_8h.html#a1a7b355512df187c56826213c5f62cac">PLEXERB_2_IO</a> = BinaryValue / 4;
                BinaryValue -= (BinaryValue / 4) * 4;
                <a class="code" href="_hardware_profile_8h.html#adfaaf446d865a14d231434f1c303d6a1">PLEXERB_1_IO</a> = BinaryValue / 2;
                BinaryValue -= (BinaryValue / 2) * 2;
                <a class="code" href="_hardware_profile_8h.html#ada4079c9d97629298e4772ec652a2f02">PLEXERB_0_IO</a> = BinaryValue;
        } <span class="comment">// PlexerDevice == 1</span>
        
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (PlexerDevice == 2) {
                <a class="code" href="_hardware_profile_8h.html#a6ea00703a12039dc8ef55ef3a04f2bb1">PLEXERC_S_IO</a> = 0; <span class="comment">//enable this device</span>
                <a class="code" href="_hardware_profile_8h.html#a8f3e28ba1bfc0de28b436a2ff6f9f6b2">PLEXERC_2_IO</a> = BinaryValue / 4;
                BinaryValue -= (BinaryValue / 4) * 4;
                <a class="code" href="_hardware_profile_8h.html#ad840cdf20fc7f32c7b96185f74acb7eb">PLEXERC_1_IO</a> = BinaryValue / 2;
                BinaryValue -= (BinaryValue / 2) * 2;
                <a class="code" href="_hardware_profile_8h.html#a4706b2cacb73a4e6e91ac7826e2a3482">PLEXERC_0_IO</a> = BinaryValue;
        } <span class="comment">// PlexerDevice == 2</span>
        
        <span class="keywordflow">else</span> {
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; !!! CheckEOL is out of range !!!!! &quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                *ADval = 0;
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;
        }
        
        
        
        <span class="comment">//60 ns delay is required for the Multiplexer to swith analogue channels</span>
        <span class="comment">//Nop();Nop();Nop();Nop();Nop();</span>
        
        <span class="comment">// Select A/D channel AN4</span>
        ADCON0 = 0b00010000;    <span class="comment">// ADON = On(1), GO/DONE = Idle (0), AN4 selected (0100), not used (0), calibration off (0)</span>
        ADCON0bits.ADON = 1;
    ADCON0bits.GO = 1;
        
    <span class="comment">// Wait until A/D conversion is done</span>
    <span class="keywordflow">while</span>(ADCON0bits.GO);
        
    <span class="comment">// Convert 10-bit value into ASCII string</span>
    *ADval = (WORD)ADRES;
    uitoa(*ADval, <a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>);
        
        <span class="keywordflow">if</span> (ZoneID == 1) {
                memset(LCDText, <span class="charliteral">&#39;\0&#39;</span>, 32);
                <span class="keywordflow">if</span> (strlen(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>) &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)4 ) strcatpgm2ram(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot; &quot;</span>);
                <span class="keywordflow">if</span> (strlen(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>) &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)4 ) strcatpgm2ram(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot; &quot;</span>);
                <span class="keywordflow">if</span> (strlen(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>) &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)4 ) strcatpgm2ram(<a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot; &quot;</span>);
                
                strcat(LCDText, <a class="code" href="_main_demo_8c.html#a3e8e6585bc03aa10ae2c1ada51f082c7">AN0String</a>);
                strcatpgm2ram(LCDText, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot;-&gt;&quot;</span>);
        }       
        
        <span class="keywordflow">if</span> ( (*ADval &gt;= (WORD)(<a class="code" href="_security_system_8h.html#a72e4cc77a027d4405fa74b0fba8780b6">EOLNORMAL</a> - <a class="code" href="_security_system_8h.html#af93892cc29e5727963f805814c86c5cf">EOLTOLERANCE</a>)) &amp;&amp; (*ADval &lt;= (WORD)(<a class="code" href="_security_system_8h.html#a72e4cc77a027d4405fa74b0fba8780b6">EOLNORMAL</a> + <a class="code" href="_security_system_8h.html#af93892cc29e5727963f805814c86c5cf">EOLTOLERANCE</a>))) {
                <span class="keywordflow">if</span> (ZoneID == 1) {
                        strcatpgm2ram(LCDText, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot;Normal&quot;</span>);
                        LCDUpdate();
                }       
                <span class="comment">// Need to consider if the zone is Normaly Open or Normaly Closed</span>
                <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsNO == <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;
                <span class="keywordflow">else</span>
                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>;
        }
        
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (*ADval &gt;= (WORD)(<a class="code" href="_security_system_8h.html#a3197ce6034da227567571e818243e9b9">EOLTRIGGER</a> - <a class="code" href="_security_system_8h.html#af93892cc29e5727963f805814c86c5cf">EOLTOLERANCE</a>)) &amp;&amp; (*ADval &lt;= (WORD)(<a class="code" href="_security_system_8h.html#a3197ce6034da227567571e818243e9b9">EOLTRIGGER</a> + <a class="code" href="_security_system_8h.html#af93892cc29e5727963f805814c86c5cf">EOLTOLERANCE</a>))) {
                <span class="keywordflow">if</span> (ZoneID == 1) {      
                        strcatpgm2ram(LCDText, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot;Trigger&quot;</span>);
                        LCDUpdate();
                }       
                <span class="comment">// Need to consider if the zone is Normaly Open or Normaly Closed</span>
                <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsNO == <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>;
                <span class="keywordflow">else</span>
                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;

        }
        
        <span class="keywordflow">else</span> {
                
                <span class="keywordflow">if</span> (ZoneID == 1) {
                        strcatpgm2ram(LCDText, (rom <span class="keywordtype">char</span> *) <span class="stringliteral">&quot;Tamper&quot;</span>);
                        LCDUpdate();
                }       
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaef85932220f85c5f09ff9f3999755180" title="Since last check the zone has changes to Tampered.">StateTamper</a>;
        }       
        
        
    
        
} <span class="comment">// CheckEOL</span>
</pre></div>
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe src="_e_o_l_8c_a1cabc40dfab4455722bcd809c23ed21d_icgraph.svg" width="1163" height="126" frameborder="0" scrolling="no"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a158856c40ce33f6a7ac1f7b0808aa8e1"></a><!-- doxytag: member="EOL.c::HTTPPrint_EOLValue" ref="a158856c40ce33f6a7ac1f7b0808aa8e1" args="(WORD num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HTTPPrint_EOLValue </td>
          <td>(</td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Prints the analogue value read from the zone, calls <a class="el" href="_e_o_l_8c.html#a1cabc40dfab4455722bcd809c23ed21d">CheckEOL()</a> to determine the value. </p>

<p>Definition at line <a class="el" href="_e_o_l_8c_source.html#l00346">346</a> of file <a class="el" href="_e_o_l_8c_source.html">EOL.c</a>.</p>

<p>References <a class="el" href="_e_o_l_8c_source.html#l00023">CheckEOL()</a>, and <a class="el" href="_h_t_t_p_variables_8c.html#a56dd5313e3ef1f8da6a1a98c9457eac1">curHTTP</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
        
        <span class="keywordtype">char</span> EOLOutput[5];
        <a class="code" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4" title="When checking the zone state in EOL, these are the possible results.">Zone_States</a> Ignore;
        WORD EOLValue;
        
        <span class="comment">// Set a flag to indicate not finished</span>
        <a class="code" href="_h_t_t_p_variables_8c.html#a56dd5313e3ef1f8da6a1a98c9457eac1">curHTTP</a>.callbackPos = 1;
        
        <span class="comment">// Make sure there&#39;s enough output space</span>
        <span class="keywordflow">if</span>(TCPIsPutReady(sktHTTP) &lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)5)
                <span class="keywordflow">return</span>;
        
        Ignore = <a class="code" href="_e_o_l_8c.html#a1cabc40dfab4455722bcd809c23ed21d">CheckEOL</a>(num, &amp;EOLValue);
        uitoa(EOLValue, EOLOutput);
        
        TCPPutArray(sktHTTP, (BYTE*)EOLOutput, (WORD) strlen(EOLOutput));
        
        <span class="comment">// Indicate that we&#39;re done</span>
        <a class="code" href="_h_t_t_p_variables_8c.html#a56dd5313e3ef1f8da6a1a98c9457eac1">curHTTP</a>.callbackPos = 0x00;
        <span class="keywordflow">return</span>;
        
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe src="_e_o_l_8c_a158856c40ce33f6a7ac1f7b0808aa8e1_cgraph.svg" width="411" height="59" frameborder="0" scrolling="no"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a44f4ef2b28f2d65b626e1ec4e5885934"></a><!-- doxytag: member="EOL.c::IsZoneTriggered" ref="a44f4ef2b28f2d65b626e1ec4e5885934" args="(int ZoneID)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4">Zone_States</a> IsZoneTriggered </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ZoneID</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Determine if there has been a state change compared to the previously know state. Regular called to track the state of the zone. Updates the ZoneConfig and AreaConfig states (Triggered &amp; Tampered). Include bounce timer to prevent zones from bouncing from one state to another and flooding the network all the time.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">ZoneID,the</td><td>zone being checked </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Zone_States, the outcome of the checked zone </dd></dl>

<p>Definition at line <a class="el" href="_e_o_l_8c_source.html#l00154">154</a> of file <a class="el" href="_e_o_l_8c_source.html">EOL.c</a>.</p>

<p>References <a class="el" href="_security_system_8c_source.html#l00149">AreaConfig</a>, <a class="el" href="_security_system_8h_source.html#l00008">AREACOUNT</a>, <a class="el" href="x_p_l_8h_source.html#l00019">BOUNCEDELAY</a>, <a class="el" href="_security_system_8h_source.html#l00179">ZoneConfigs::BounceDelay</a>, <a class="el" href="_e_o_l_8c_source.html#l00023">CheckEOL()</a>, <a class="el" href="x_p_l_8h_source.html#l00004">FALSE</a>, <a class="el" href="_security_system_8c_source.html#l00035">i2Count</a>, <a class="el" href="_security_system_8c_source.html#l00035">iCount</a>, <a class="el" href="_security_system_8h_source.html#l00192">AreaConfigs::IsTampered</a>, <a class="el" href="_security_system_8h_source.html#l00174">ZoneConfigs::IsTampered</a>, <a class="el" href="_security_system_8h_source.html#l00186">AreaConfigs::IsTriggered</a>, <a class="el" href="_security_system_8h_source.html#l00166">ZoneConfigs::IsTriggered</a>, <a class="el" href="_security_system_8c_source.html#l01467">isZoneMemberOfArea()</a>, <a class="el" href="_hardware_profile_8h_source.html#l00204">putrsUART</a>, <a class="el" href="_hardware_profile_8h_source.html#l00201">putsUART</a>, <a class="el" href="_security_system_8h_source.html#l00155">StateNormal</a>, <a class="el" href="_security_system_8h_source.html#l00154">StateNothing</a>, <a class="el" href="_security_system_8h_source.html#l00157">StateTamper</a>, <a class="el" href="_security_system_8h_source.html#l00156">StateTrigger</a>, <a class="el" href="x_p_l_8h_source.html#l00005">TRUE</a>, <a class="el" href="x_p_l_8c_source.html#l00014">xPLMsgKey</a>, <a class="el" href="_security_system_8c_source.html#l00143">ZoneConfig</a>, and <a class="el" href="_security_system_8h_source.html#l00007">ZONECOUNT</a>.</p>

<p>Referenced by <a class="el" href="_security_system_8c_source.html#l00780">IOTasks()</a>.</p>
<div class="fragment"><pre class="fragment">                                          { 
        
        
        <a class="code" href="_security_system_8h.html#abdc99e93ae47c7d6cb907274a3018ff4" title="When checking the zone state in EOL, these are the possible results.">Zone_States</a> TheZoneState, PreviousZoneState;
        WORD Ignore;
        
        <span class="comment">//ensure zone is not bypassed or isolated, if so return nothing</span>
        <span class="keywordflow">if</span> ((<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsIsolated) || (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsBypassed)) 
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff0f80ff8f066737372b052c2160509a" title="Nothing has changed since the last check.">StateNothing</a>;
        
        <span class="comment">// What is the previous state</span>
        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsTampered) PreviousZoneState = <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaef85932220f85c5f09ff9f3999755180" title="Since last check the zone has changes to Tampered.">StateTamper</a>;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].IsTriggered) PreviousZoneState = <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>;
        <span class="keywordflow">else</span> PreviousZoneState = <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;
        
        <span class="comment">// Determine the state of the zone</span>
        TheZoneState = <a class="code" href="_e_o_l_8c.html#a1cabc40dfab4455722bcd809c23ed21d">CheckEOL</a>(ZoneID, &amp;Ignore);
        
        <span class="comment">//If the state is the same as the previous check and bounce timer not active return nothing.</span>
        <span class="keywordflow">if</span>  ((PreviousZoneState == TheZoneState ) &amp;&amp; (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].BounceDelay == (<span class="keywordtype">unsigned</span>) 0))  
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff0f80ff8f066737372b052c2160509a" title="Nothing has changed since the last check.">StateNothing</a>;
        
        <span class="comment">// *** TAMPER ***</span>
        
        <span class="comment">// Zone is Tampered</span>
        <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaef85932220f85c5f09ff9f3999755180" title="Since last check the zone has changes to Tampered.">StateTamper</a>) {
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a71861cd65add7649dffdc7f99c57595c" title="Is the zone in a tampered state.">IsTampered</a> = <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0; <span class="comment">// Will cause a loop always returning StateTamper if left out</span>
                
                <span class="comment">// find out what Areas the zone is a part of and set them to tampered</span>
                <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> = 0; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> &lt; <a class="code" href="_security_system_8h.html#af9feef5e257517789486c320b17e82bd">AREACOUNT</a>; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>++) {
                        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(ZoneID, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                <a class="code" href="_security_system_8c.html#a6d79e0918c6b94528f6283856d663a9b" title="Stores each Area configuration information.">AreaConfig</a>[<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>].<a class="code" href="struct_area_configs.html#ad6fce28b6a7036035b3a51d4d25df694" title="Has a zone in this area been tampered.">IsTampered</a> = <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Area &quot;</span>);
                                uitoa(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; is Tampered. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                        }<span class="comment">// isZoneMemberOfArea(ZoneID, iCount)</span>
                }<span class="comment">// iCount      </span>
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaef85932220f85c5f09ff9f3999755180" title="Since last check the zone has changes to Tampered.">StateTamper</a>;
        } <span class="comment">// StateTamper</span>
        
        
        <span class="comment">// Return from Tamper</span>
        <span class="keywordflow">if</span> (PreviousZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaef85932220f85c5f09ff9f3999755180" title="Since last check the zone has changes to Tampered.">StateTamper</a>) {
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a71861cd65add7649dffdc7f99c57595c" title="Is the zone in a tampered state.">IsTampered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0; 
                
                <span class="comment">// find out what Areas the zone is a part and set tamper to false if no other zones in the area are tampered</span>
                <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> = 0; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> &lt; <a class="code" href="_security_system_8h.html#af9feef5e257517789486c320b17e82bd">AREACOUNT</a>; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>++) {
                        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(ZoneID, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>=0; <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> &lt; <a class="code" href="_security_system_8h.html#a36673b0aa547051d1b4ee6516939b83b">ZONECOUNT</a>; <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>++) {
                                        <span class="keywordflow">if</span> ((<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> != ZoneID) &amp;&amp; <a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                                <span class="keywordflow">if</span>( <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>].IsTampered == <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
                                                        <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> = 1;
                                                        <span class="keywordflow">break</span>;
                                                }<span class="comment">// is triggered</span>
                                        }<span class="comment">// is member of the zone                </span>
                                }<span class="comment">//i2Count, Area in question</span>
                                <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> &gt;= ZONECOUNT) { <span class="comment">// no zones in the area found to be triggered</span>
                                        <a class="code" href="_security_system_8c.html#a6d79e0918c6b94528f6283856d663a9b" title="Stores each Area configuration information.">AreaConfig</a>[<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>].<a class="code" href="struct_area_configs.html#ad6fce28b6a7036035b3a51d4d25df694" title="Has a zone in this area been tampered.">IsTampered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;  
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Area &quot;</span>);
                                        uitoa(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                        <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; is not tampered. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                                }<span class="comment">// i2Count &gt;= ZONECOUNT        </span>
                        }<span class="comment">// isZoneMemberOfArea(ZoneID, iCount)</span>
                }<span class="comment">// iCount              </span>
                
                <span class="comment">// When changing from Tampered to Triggered this will generate a Triggered event after the tamper cleared event</span>
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a9dca0cb314a3d8a1cb83a2b474296cce" title="If the zone in a triggered state.">IsTriggered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
                <span class="comment">// Return as normal even if triggered to ensure message sequence is correct</span>
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;
                
        }       
        
        
        <span class="comment">// *** BOUNCE / TRIGGER CLEARED ***</span>
        
        <span class="comment">//Every time we return from Triggered to Normal there is a delay of .5 Second, this limits bouncing speed.</span>
        <span class="comment">//If BounceTimer not expired return Nothing. If we are bouncing it will only send 2 msg per 1/2 second. Do not change previous state </span>
        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].BounceDelay &gt; (<span class="keywordtype">unsigned</span>) 1) {
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a>--;
                <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>)
                        <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0;     
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff0f80ff8f066737372b052c2160509a" title="Nothing has changed since the last check.">StateNothing</a>;
        }        
        
        <span class="comment">//if BounceTimer is expired clear BounceTimer</span>
        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].BounceDelay == (<span class="keywordtype">unsigned</span>) 1) {
                
                <span class="comment">// if state = Trigger then return nothing as we have bounced back (Trigger, Normal Trigger)</span>
                <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>) {
                        <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0;
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Bounce prevented. Zone &quot;</span>);
                        uitoa(ZoneID, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                        <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; remains triggered.\r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff0f80ff8f066737372b052c2160509a" title="Nothing has changed since the last check.">StateNothing</a>;
                }
                
                <span class="comment">// if state = normal return Normal and set the state flag on the zone</span>
                <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>) {
                        <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0;
                        <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a9dca0cb314a3d8a1cb83a2b474296cce" title="If the zone in a triggered state.">IsTriggered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
                        <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a71861cd65add7649dffdc7f99c57595c" title="Is the zone in a tampered state.">IsTampered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
                        
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Bounce Cleared. Zone &quot;</span>);
                        uitoa(ZoneID, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                        <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                        <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; is normal. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                        
                        <span class="comment">// find out what Areas the zone is a part and set triggered to false if no other zones in the area</span>
                        <span class="comment">// are also triggered at the same time</span>
                        <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> = 0; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> &lt; <a class="code" href="_security_system_8h.html#af9feef5e257517789486c320b17e82bd">AREACOUNT</a>; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>++) {
                                <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(ZoneID, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                        <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>=0; <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> &lt; <a class="code" href="_security_system_8h.html#a36673b0aa547051d1b4ee6516939b83b">ZONECOUNT</a>; <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>++) {
                                                <span class="keywordflow">if</span> ((<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> != ZoneID) &amp;&amp; <a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                                        <span class="keywordflow">if</span>( <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a>].IsTriggered == <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
                                                                <a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> = 1;
                                                                <span class="keywordflow">break</span>;
                                                        }<span class="comment">// is triggered</span>
                                                }<span class="comment">// is member of the zone                </span>
                                        }<span class="comment">//i2Count, Area in question</span>
                                        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a57f58df4fd7d5efb217812f40e79a968">i2Count</a> &gt;= ZONECOUNT) { <span class="comment">// no zones in the area found to be triggered</span>
                                                <a class="code" href="_security_system_8c.html#a6d79e0918c6b94528f6283856d663a9b" title="Stores each Area configuration information.">AreaConfig</a>[<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>].<a class="code" href="struct_area_configs.html#a4b3904923f06e20608888f1d3ad4ac08" title="Is the Area triggered.">IsTriggered</a> = <a class="code" href="x_p_l_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; 
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Area &quot;</span>);
                                                uitoa(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                                <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; is normal. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                                        }<span class="comment">// i2Count &gt;= ZONECOUNT        </span>
                                }<span class="comment">// isZoneMemberOfArea(ZoneID, iCount)</span>
                        }<span class="comment">// iCount              </span>
                        
                        <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>;
                }
        }       
        
        
        <span class="comment">//If current state Normal, set the BounceTimer, return Nothing</span>
        <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff695d83533d89f59fa409f3d0301875" title="Since last check the zone has changed to normal.">StateNormal</a>) {
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = <a class="code" href="x_p_l_8h.html#a0c1636b2b06436f6cbb88eb341f7d902">BOUNCEDELAY</a>;
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (ZoneID == 0) <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Bounce Set. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfaff0f80ff8f066737372b052c2160509a" title="Nothing has changed since the last check.">StateNothing</a>;
        }
        
        <span class="comment">// *** TRIGGER ***</span>
        
        <span class="comment">//The only thing left should be a normal trigger, return trigger and set the state flag on the zone</span>
        <span class="keywordflow">if</span> (TheZoneState == <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>) {
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#ad96ab4189da090b75417a4705b3c092b" title="Timer for reducing impact of a bouncing IO lines.">BounceDelay</a> = 0;
                <a class="code" href="_security_system_8c.html#af027bc313be80301e927d4717cb0dc90" title="Stores each Zones configuration information.">ZoneConfig</a>[ZoneID].<a class="code" href="struct_zone_configs.html#a9dca0cb314a3d8a1cb83a2b474296cce" title="If the zone in a triggered state.">IsTriggered</a> = <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
                
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;Zone &quot;</span>);
                uitoa(ZoneID, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;triggered. &quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                
                <span class="comment">// find out what Areas the zone is a part of and set them to triggered</span>
                <span class="keywordflow">for</span>(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> = 0; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a> &lt; <a class="code" href="_security_system_8h.html#af9feef5e257517789486c320b17e82bd">AREACOUNT</a>; <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>++) {
                        <span class="keywordflow">if</span> (<a class="code" href="_security_system_8c.html#a290b0da69aaf212aa38c219c45a6d8a9">isZoneMemberOfArea</a>(ZoneID, <a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>)) {
                                <a class="code" href="_security_system_8c.html#a6d79e0918c6b94528f6283856d663a9b" title="Stores each Area configuration information.">AreaConfig</a>[<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>].<a class="code" href="struct_area_configs.html#a4b3904923f06e20608888f1d3ad4ac08" title="Is the Area triggered.">IsTriggered</a> = <a class="code" href="x_p_l_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<span class="preprocessor">#if defined(DEBUG_UART)</span>
<span class="preprocessor"></span>                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; Area &quot;</span>);
                                uitoa(<a class="code" href="_security_system_8c.html#a45c8f1ff198e164451795c949f64747a" title="Counters that are used in a number of places, centraly defined to reduce memory use.">iCount</a>, <a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                <a class="code" href="_hardware_profile_8h.html#a83f63fc3181f38af4c937906f34341c8">putsUART</a>(<a class="code" href="x_p_l_8c.html#ab1bd647d7b5e8841a1378eedabb62c2e" title="Security, were most of it is at.">xPLMsgKey</a>);
                                <a class="code" href="_hardware_profile_8h.html#afa49df8d2ce2ae222717e01eb8ed070e">putrsUART</a>((ROM <span class="keywordtype">char</span>*)<span class="stringliteral">&quot; is Triggered. \r\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                        }<span class="comment">// isZoneMemberOfArea(ZoneID, iCount)</span>
                }<span class="comment">// iCount      </span>
                
                <span class="keywordflow">return</span> <a class="code" href="_security_system_8h.html#aa6c45927fecfdf58fd988dacbeca2fbfa28c4bd56c6dff19d5f2741a0cb5ed47f" title="Since last check the zone has changes to Triggered.">StateTrigger</a>;
        }       
        
} <span class="comment">//IsZoneTriggered</span>
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe src="_e_o_l_8c_a44f4ef2b28f2d65b626e1ec4e5885934_cgraph.svg" width="504" height="126" frameborder="0" scrolling="no"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe src="_e_o_l_8c_a44f4ef2b28f2d65b626e1ec4e5885934_icgraph.svg" width="886" height="59" frameborder="0" scrolling="no"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Apr 25 2011 23:31:10 for Alarm Cabinent by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
