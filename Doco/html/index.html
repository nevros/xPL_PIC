<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Alarm Cabinent: Project overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Alarm Cabinent</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Project overview </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>This application has been developed to work with the microchip TCIP stack.</p>
<h2><a class="anchor" id="a1"></a>
xPL Framework</h2>
<p>The xPL framework provides the following feature:</p>
<ul>
<li>Parsing all inbound xPL messages and converts them into a manageable data structure</li>
<li>Only passes relevant xPL messages to the device being implemented</li>
<li>Providing a consistent and easy method of transmitting all xPL messages</li>
<li>Handling all heart beat functionality</li>
<li>Greatly simplifying the device configuration process</li>
</ul>
<p>The device being implemented only needs to have the following methods exposed:</p>
<ul>
<li>BOOL SchemaInit (void) - Returns true if the device has configuration, false sets the device into an un configured state</li>
<li>BOOL SchemaTasks (void) - Is called with each co operative multi tasking cycle, return True if a messages has been placed in the outbound queue</li>
<li>void SchemaProcessUDPMsg (void) - This is called by the xPL framework to process an inbound xPL message</li>
</ul>
<p>The xPL framework is initialised from the main.c file by opening a UDP socket, waiting for the network to stabilise and then calling the <a class="el" href="x_p_l_8c.html#a091a12042a9d63dc524ce896fbc04b46">xPLInit()</a> function. From main.c you call the StackTask() as a part of the TCPIP framework and maybe StackApplications(); if you are in the mood for running other services that are a part of the Microchip stack. After these functions are called then the xPL stack task is called.</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">void</span> <a class="code" href="_main_demo_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667">main</a>(<span class="keywordtype">void</span>) { 
        <span class="keywordflow">while</span>(1) { 
                StackTask(); 
                StackApplications(); 
                <a class="code" href="x_p_l_8c.html#a86d914c966f337c4e3a6fda46a945d11">XPLTasks</a>(); 
        } 
 } 
</pre></div><p>Inside <a class="el" href="x_p_l_8c.html#a86d914c966f337c4e3a6fda46a945d11">XPLTasks()</a> there are 3 other tasks that need to run in this order,</p>
<ul>
<li>Implemented schema related tasks - <a class="el" href="_security_system_8c.html#a62b4d90791ab073f74677d42bfb64253">SchemaTasks()</a></li>
<li>UDP input buffer, for processing inbound messages</li>
<li>xPL heart beat message generation <br/>
 <br/>
 Remember the Microchip TCP framework StackTask() needs to be called to flush the transmit buffer each time, hence only one can run per task run! The order is determined by importance, with the most important function being executed first. <br/>
 <br/>
 </li>
</ul>
<h2><a class="anchor" id="a2"></a>
Useful tools when implementing an xPL device:</h2>
<ul>
<li><a class="el" href="x_p_l_8c.html#abde6ae0f37ef47bee8e881bba8502169">XPLSendHeader()</a> <br/>
 Used to create any xPL message. Populates the header then adds class type and opens the body. <br/>
</li>
</ul>
<ul>
<li><a class="el" href="x_p_l_8c.html#a1099a7d6ccfe562deba149fd4acef424">xPLSaveEEConfig()</a> <br/>
 Accepts configuration data (in the form of a pointer) and saves it to EE Prom. Used in the <a class="el" href="_security_system_8c.html#aea89a2e5b007623f49cb6117afc947ec">SchemaInit()</a> procedure.</li>
</ul>
<ul>
<li><a class="el" href="x_p_l_8c.html#a31c1c8faace74e23f37a03b7292f7981">xPLLoadEEConfig()</a> <br/>
 Loads data from EE Prom into the selected config pointer. Used in the <a class="el" href="_security_system_8c.html#aea89a2e5b007623f49cb6117afc947ec">SchemaInit()</a> procedure.</li>
</ul>
<ul>
<li><a class="el" href="x_p_l_8c.html#a7c4561dc703960b7f5d24ec72ff34ba5">SaveKVP()</a> <br/>
 Loads a Key and a Value from the UDP message. Used in processing messages in <a class="el" href="_security_system_8c.html#a3baecc6556e5cc7af0d59d0216aa217c">SchemaProcessUDPMsg()</a></li>
</ul>
<ul>
<li><a class="el" href="x_p_l_8c.html#ace930888808081ff410b21e68caa146e">xPLFindArrayInKVP()</a> <br/>
 Searches though an array looking for a match to TheValue. When a match is found it will return the position in the array. Used in processing messages in <a class="el" href="_security_system_8c.html#a3baecc6556e5cc7af0d59d0216aa217c">SchemaProcessUDPMsg()</a></li>
</ul>
<h2><a class="anchor" id="a3"></a>
Security</h2>
<p>Functions of the secrutiy schema are called via three entry points <br/>
 1) <a class="el" href="_h_t_t_p_forms_8c.html#a686ae35a16ecb63daffafcd015ddb070" title="Processes all HTTP GETS.">HTTPExecuteGet()</a>, the result of posting data on the HTTP form. <br/>
 2) <a class="el" href="_security_system_8c.html#a3baecc6556e5cc7af0d59d0216aa217c">SchemaProcessUDPMsg()</a>, receiving xPL data. <br/>
 3) <a class="el" href="_security_system_8c.html#a62b4d90791ab073f74677d42bfb64253">SchemaTasks()</a>, xPL framework calling the secuirty_system.c task function<br/>
</p>
<p>When sending an xPL message, it is placed into xPLTaskList where the function <a class="el" href="_security_system_8c.html#a62b4d90791ab073f74677d42bfb64253">SchemaTasks()</a> then excitues the fuction once a UDP socket is available. The same function decides when to check the input pins for changes in the alarm sensore, <a class="el" href="_security_system_8c.html#a3ccbc635f6f7bb31465920840c7db474">IOTasks()</a> and battery related function <a class="el" href="_battery_8c.html#ad7abffae7b40c1538c5411bfd808a68a" title="Task process for managing the battery state.">BatteryTask()</a>.</p>
<p>Data Structure: <br/>
 <a class="el" href="structx_p_l_configs.html" title="General system Configuration entries.">xPLConfigs</a> is all of the confiration data for the device. This data is saved and loaded out of the EE Prom <br/>
 <a class="el" href="struct_area_configs.html" title="Stores each Area configuration information.">AreaConfigs</a> and <a class="el" href="struct_zone_configs.html" title="Stores all of the configuration for ech of the zones.">ZoneConfigs</a> hold tempery state information on individual areas and zones. <br/>
 </p>
</div></div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Apr 25 2011 23:31:09 for Alarm Cabinent by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
